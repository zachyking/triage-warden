# Malware detection test cases for Triage Warden evaluation
# Contains true positive and false positive cases

# TRUE POSITIVE: Ransomware behavior detected
- id: malware_001
  name: "Ransomware encryption activity detected"
  alert:
    type: endpoint_detection
    hostname: "WORKSTATION-042"
    username: "jsmith"
    process_name: "suspicious.exe"
    process_path: "C:\\Users\\jsmith\\AppData\\Local\\Temp\\suspicious.exe"
    process_hash: "d41d8cd98f00b204e9800998ecf8427e"
    parent_process: "outlook.exe"
    command_line: "suspicious.exe --encrypt --target=C:\\Users"
    behaviors:
      - "Mass file modification detected"
      - "Shadow copy deletion attempted"
      - "Ransom note dropped in multiple directories"
    file_operations:
      - operation: "modify"
        path: "C:\\Users\\jsmith\\Documents\\*.docx"
        count: 150
      - operation: "create"
        path: "C:\\Users\\jsmith\\Documents\\README_DECRYPT.txt"
    network_connections:
      - destination: "185.141.25.68"
        port: 443
        protocol: "tcp"
    timestamp: "2024-01-15T11:45:00Z"
  expected:
    verdict: malicious
    severity: critical
    techniques: [T1486, T1490, T1059.001]

# FALSE POSITIVE: Legitimate backup software behavior
- id: malware_002
  name: "Backup software mass file operations"
  alert:
    type: endpoint_detection
    hostname: "FILESERVER-01"
    username: "SYSTEM"
    process_name: "BackupExec.exe"
    process_path: "C:\\Program Files\\Veritas\\Backup Exec\\BackupExec.exe"
    process_hash: "abc123def456789012345678901234ab"
    parent_process: "services.exe"
    command_line: "BackupExec.exe /backup /full"
    behaviors:
      - "Mass file read operations"
      - "Large data transfer to network location"
    file_operations:
      - operation: "read"
        path: "C:\\SharedData\\**\\*"
        count: 10000
    network_connections:
      - destination: "10.0.0.100"
        port: 445
        protocol: "tcp"
    signed: true
    signer: "Veritas Technologies LLC"
    timestamp: "2024-01-15T02:00:00Z"
  expected:
    verdict: benign
    severity: informational
    techniques: []

# TRUE POSITIVE: Cobalt Strike beacon detected
- id: malware_003
  name: "Cobalt Strike beacon communication"
  alert:
    type: endpoint_detection
    hostname: "WORKSTATION-108"
    username: "admin.service"
    process_name: "rundll32.exe"
    process_path: "C:\\Windows\\System32\\rundll32.exe"
    process_hash: "1a2b3c4d5e6f789012345678901234cd"
    parent_process: "powershell.exe"
    command_line: "rundll32.exe C:\\Users\\Public\\payload.dll,Start"
    behaviors:
      - "Reflective DLL injection detected"
      - "Named pipe communication"
      - "Periodic beaconing to C2"
    network_connections:
      - destination: "cdn.malicious-domain.com"
        port: 443
        protocol: "tcp"
        bytes_sent: 1024
        bytes_received: 2048
        interval: "60s"
    memory_artifacts:
      - "Cobalt Strike configuration block detected"
      - "Sleep mask function identified"
    timestamp: "2024-01-15T16:30:00Z"
  expected:
    verdict: malicious
    severity: critical
    techniques: [T1055.001, T1071.001, T1573.002]

# FALSE POSITIVE: Development tool triggering heuristics
- id: malware_004
  name: "Developer IDE compiling and debugging"
  alert:
    type: endpoint_detection
    hostname: "DEV-WORKSTATION-05"
    username: "developer.alice"
    process_name: "devenv.exe"
    process_path: "C:\\Program Files\\Microsoft Visual Studio\\2022\\Enterprise\\Common7\\IDE\\devenv.exe"
    process_hash: "validhash12345678901234567890abcd"
    parent_process: "explorer.exe"
    command_line: "devenv.exe /build Debug MyProject.sln"
    behaviors:
      - "Process injection detected"
      - "Memory manipulation"
      - "Code compilation"
    child_processes:
      - name: "msbuild.exe"
        path: "C:\\Program Files\\Microsoft Visual Studio\\2022\\Enterprise\\MSBuild\\Current\\Bin\\MSBuild.exe"
      - name: "vctip.exe"
        path: "C:\\Program Files\\Microsoft Visual Studio\\2022\\Enterprise\\VC\\Tools\\MSVC\\14.35.32215\\bin\\Hostx64\\x64\\vctip.exe"
    signed: true
    signer: "Microsoft Corporation"
    timestamp: "2024-01-15T10:15:00Z"
  expected:
    verdict: benign
    severity: low
    techniques: []

# SUSPICIOUS: PowerShell with encoded command from legitimate parent
- id: malware_005
  name: "Encoded PowerShell from scheduled task - ambiguous"
  alert:
    type: endpoint_detection
    hostname: "WORKSTATION-077"
    username: "admin.local"
    process_name: "powershell.exe"
    process_path: "C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe"
    process_hash: "de96a6e69944335375dc1ac238336066"
    parent_process: "schtasks.exe"
    command_line: "powershell.exe -EncodedCommand SQBuAHYAbwBrAGUALQBXAGUAYgBSAGUAcQB1AGUAcwB0ACAALQBVAHIAaQAgACIAaAB0AHQAcABzADoALwAvAHUAcABkAGEAdABlAC4AYwBvAG0AcABhAG4AeQAuAGMAbwBtAC8AYQBnAGUAbgB0ACIAIAAtAE8AdQB0AEYAaQBsAGUAIAAiAEMAOgBcAFQAZQBtAHAAXABhAGcAZQBuAHQALgBlAHgAZQAiAA=="
    decoded_command: "Invoke-WebRequest -Uri 'https://update.company.com/agent' -OutFile 'C:\\Temp\\agent.exe'"
    behaviors:
      - "Encoded PowerShell execution"
      - "File download from internet"
    network_connections:
      - destination: "update.company.com"
        port: 443
        protocol: "tcp"
    signed: true
    signer: "Microsoft Corporation"
    scheduled_task_name: "CompanyAgentUpdate"
    timestamp: "2024-01-15T06:00:00Z"
  expected:
    verdict: suspicious
    severity: medium
    techniques: [T1059.001, T1027]

# SUSPICIOUS: Unusual process tree with some legitimate indicators
- id: malware_006
  name: "Excel spawning cmd.exe with network activity"
  alert:
    type: endpoint_detection
    hostname: "FINANCE-WS-03"
    username: "accountant.bob"
    process_name: "cmd.exe"
    process_path: "C:\\Windows\\System32\\cmd.exe"
    process_hash: "ad7b9c14083b52bc532fba5948342b98"
    parent_process: "EXCEL.EXE"
    grandparent_process: "explorer.exe"
    command_line: "cmd.exe /c curl https://api.company.com/reports/export > C:\\Users\\accountant.bob\\Documents\\report.csv"
    behaviors:
      - "Office application spawning command shell"
      - "Data download via command line"
    file_operations:
      - operation: "create"
        path: "C:\\Users\\accountant.bob\\Documents\\report.csv"
    network_connections:
      - destination: "api.company.com"
        port: 443
        protocol: "tcp"
    excel_file: "C:\\Users\\accountant.bob\\Downloads\\Monthly_Report_Generator.xlsm"
    vba_project_locked: false
    timestamp: "2024-01-15T14:30:00Z"
  expected:
    verdict: suspicious
    severity: medium
    techniques: [T1059.003, T1204.002]

# SUSPICIOUS: Process injection indicators but from security tool
- id: malware_007
  name: "Security tool with injection-like behavior"
  alert:
    type: endpoint_detection
    hostname: "WORKSTATION-125"
    username: "SYSTEM"
    process_name: "CrowdStrikeAgent.exe"
    process_path: "C:\\Program Files\\CrowdStrike\\CrowdStrikeAgent.exe"
    process_hash: "9a8b7c6d5e4f3a2b1c0d9e8f7a6b5c4d"
    parent_process: "services.exe"
    command_line: "CrowdStrikeAgent.exe"
    behaviors:
      - "Process memory injection detected"
      - "API hooking activity"
      - "Kernel driver loading"
    memory_operations:
      - target_process: "chrome.exe"
        operation: "write"
      - target_process: "outlook.exe"
        operation: "write"
    signed: true
    signer: "CrowdStrike Inc"
    timestamp: "2024-01-15T08:00:00Z"
  expected:
    verdict: suspicious
    severity: medium
    techniques: [T1055]

# INCONCLUSIVE: Partial telemetry data
- id: malware_008
  name: "Process activity with missing context"
  alert:
    type: endpoint_detection
    hostname: "REMOTE-LAPTOP-42"
    username: "remote.worker"
    process_name: "unknown.exe"
    process_path: "C:\\Users\\remote.worker\\Downloads\\unknown.exe"
    process_hash: "hash_not_available"
    parent_process: "explorer.exe"
    command_line: "unknown.exe"
    behaviors:
      - "Process started from Downloads folder"
    file_operations: []
    network_connections: []
    signed: "unknown"
    agent_status: "intermittent_connectivity"
    telemetry_gaps: true
    timestamp: "2024-01-15T13:45:00Z"
  expected:
    verdict: inconclusive
    severity: medium
    techniques: []

# INCONCLUSIVE: Conflicting threat intelligence
- id: malware_009
  name: "Binary with conflicting reputation scores"
  alert:
    type: endpoint_detection
    hostname: "WORKSTATION-089"
    username: "developer.charlie"
    process_name: "toolkit.exe"
    process_path: "C:\\Tools\\SecurityAudit\\toolkit.exe"
    process_hash: "3f4a5b6c7d8e9f0a1b2c3d4e5f6a7b8c"
    parent_process: "explorer.exe"
    command_line: "toolkit.exe --scan-ports --target=10.0.0.0/24"
    behaviors:
      - "Port scanning activity"
      - "Network reconnaissance"
    network_connections:
      - destination: "10.0.0.0/24"
        ports: [22, 80, 443, 3389]
        protocol: "tcp"
    threat_intel:
      vendor_a: "malicious"
      vendor_b: "clean"
      vendor_c: "suspicious"
      virustotal_score: "8/70"
    signed: true
    signer: "Unknown Publisher"
    user_department: "Security Team"
    timestamp: "2024-01-15T15:20:00Z"
  expected:
    verdict: inconclusive
    severity: medium
    techniques: [T1046]
